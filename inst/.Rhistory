library(dplyr)
library(mvtnorm)
library(grf)
source("../R/rbf.R")
library(dplyr)
library(mvtnorm)
library(grf)
source("../R/rbf.R")
# getting mimic dataset for testing
#dataset <- readr::read_csv("./test_data_locf.csv")[, -1]
data(dataset)
# getting mimic dataset for testing
#dataset <- readr::read_csv("./test_data_locf.csv")[, -1]
data(dataset)
load(file='../data/dataset.rda')
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME")) %>%
# ilter(charttime <= 4) select(subject_id, charttime, sbp, bicar,
# na, age, weight, los_icu, death, sofa, vent_ind, vaso_ind) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map, los_icu,
sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1", any(vent_ind) &
is.na(vaso_ind) ~ "2", is.na(vent_ind) & any(vaso_ind) ~ "3", is.na(vent_ind) &
is.na(vaso_ind) ~ NA)) %>%
filter(!all(is.na(trt_group))) %>%
filter(charttime <= 12)
View(dataset)
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME")))
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME"))
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind)
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1", any(vent_ind) &
is.na(vaso_ind) ~ "2", is.na(vent_ind) & any(vaso_ind) ~ "3", is.na(vent_ind) &
is.na(vaso_ind) ~ NA))
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
group_by(subject_id) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
group_by(subject_id) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1", any(vent_ind) &
is.na(vaso_ind) ~ "2", is.na(vent_ind) & any(vaso_ind) ~ "3", is.na(vent_ind) &
is.na(vaso_ind) ~ NA)) %>%
filter(!all(is.na(trt_group))) %>%
filter(charttime <= 12)
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA)) %>%
filter(!all(is.na(trt_group))) %>%
filter(charttime <= 12)
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(
any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA
))
?case_when
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
TRUE ~ NA)) %>%
filter(!all(is.na(trt_group))) %>%
filter(charttime <= 12)
View(dataset)
dataset2 <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>%
filter(any(discharge_location == "HOME")) %>%
select(subject_id, charttime, sbp, bicar, na, age, weight, k, map,
los_icu, sofa, vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(
vent_ind & vaso_ind ~ "1",
vent_ind & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & vaso_ind ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA
))
test <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>% filter(subject_id == 62) %>%
select(vent_ind, vaso_ind)
View(test)
test <- dataset %>%
group_by(subject_id) %>%
filter(n() >= 12) %>% filter(subject_id == 62) %>%
select(vent_ind, vaso_ind) %>% mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA))
test <- dataset %>%
filter(n() >= 12) %>% filter(subject_id == 62) %>%
select(vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA))
case_when(any(vent_ind) & any(vaso_ind) ~ "1",
any(vent_ind) & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & any(vaso_ind) ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA)
any(dataset$vent_ind)
any(test$vent_ind)
any(test$vaso_ind)
any(test$vent_ind) & any(test$vaso_ind)
any(test$vent_ind)
any(test$vent_ind) & is.na(test$vaso_ind)
is.na(test$vent_ind) & any(test$vaso_ind)
is.na(test$vent_ind) & is.na(test$vaso_ind)
test <- dataset %>%
filter(n() >= 12) %>% filter(subject_id == 62) %>%
select(vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(
vent_ind & vaso_ind ~ "1",
vent_ind & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & vaso_ind ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA
))
?case_when
test <- dataset %>%
filter(n() >= 12) %>% filter(subject_id == 62) %>%
select(vent_ind, vaso_ind) %>%
mutate(trt_group = case_when(
vent_ind & vaso_ind ~ "1",
vent_ind & is.na(vaso_ind) ~ "2",
is.na(vent_ind) & vaso_ind ~ "3",
is.na(vent_ind) & is.na(vaso_ind) ~ NA
))
library(installr)
updateR()
